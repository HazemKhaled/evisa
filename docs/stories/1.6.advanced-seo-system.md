# Story 1.6: Advanced SEO System with Dynamic Sitemaps

## Status

Draft

## Story

**As a** marketing stakeholder,
**I want** comprehensive SEO optimization with dynamic sitemap generation,
**so that** the platform achieves high search rankings for visa-related queries.

## Acceptance Criteria

1. Sitemap index at `/sitemap-index.xml` linking to all destination sitemaps
2. Country-specific sitemaps at `/d/{DESTINATION_COUNTRY}/sitemap.xml`
3. Main sitemap at `/sitemap.xml` for standalone pages (contact, terms, etc.)
4. Structured data (JSON-LD) for destinations, visa types, and blog posts
5. Meta tag optimization with descriptions, keywords, and canonical URLs

## Tasks / Subtasks

- [ ] Implement sitemap generation system (AC: 1, 2, 3)
  - [ ] Create `/public/app/sitemap-index/route.ts` for main sitemap index generation
  - [ ] Create `/src/app/sitemap.ts` for core site pages sitemap
  - [ ] Create `/src/app/[locale]/d/[destination]/sitemap.ts` for destination-specific sitemaps
  - [ ] Create `/src/app/[locale]/blog/sitemap.ts` for blog posts sitemap
  - [ ] Implement dynamic sitemap generation based on database content

- [ ] Build structured data (JSON-LD) system (AC: 4)
  - [ ] Extend `/src/lib/json-ld.ts` with destination and visa type schemas
  - [ ] Create blog post JSON-LD schema generation
  - [ ] Implement organization and website schema markup
  - [ ] Add breadcrumb structured data for navigation
  - [ ] Create FAQ schema for common visa questions

- [ ] Implement dynamic meta tag optimization (AC: 5)
  - [ ] Extend `generateMetadata` functions for all destination pages
  - [ ] Create SEO-optimized meta descriptions for destinations and visa types
  - [ ] Implement canonical URL generation for all page types
  - [ ] Add Open Graph tags for social media sharing
  - [ ] Create Twitter Card meta tags for enhanced social visibility

- [ ] Add SEO utilities and optimization functions (AC: 4, 5)
  - [ ] Create SEO utility functions in `/src/lib/utils/seo.ts`
  - [ ] Implement meta tag generation helpers
  - [ ] Add structured data validation and testing utilities
  - [ ] Create SEO metadata extraction from database content
  - [ ] Implement keyword optimization for destination and visa content

- [ ] Integrate SEO system with existing pages (AC: 1, 2, 3, 4, 5)
  - [ ] Update all destination pages with proper SEO implementation
  - [ ] Add SEO optimization to blog system
  - [ ] Integrate structured data with visa eligibility pages
  - [ ] Update homepage and static pages with enhanced SEO
  - [ ] Ensure all sitemaps are properly linked and accessible

- [ ] Performance and SEO validation (AC: 1, 2, 3, 4, 5)
  - [ ] Validate sitemap generation performance with large datasets
  - [ ] Test structured data markup with Google Rich Results Test
  - [ ] Verify canonical URL implementation across all page types
  - [ ] Test sitemap accessibility and proper XML formatting
  - [ ] Validate Core Web Vitals impact of SEO enhancements

## Dev Notes

### Sitemap Generation Architecture

**Next.js Sitemap System**: [Source: architecture/source-tree.md#Application Router]

- Use Next.js 15 built-in sitemap generation capabilities
- Dynamic sitemap generation based on database content
- Proper XML formatting and lastModified timestamps
- Integration with existing route structure

**Sitemap Structure**:

```
/sitemap-index.xml (main index)
├── /sitemap.xml (core pages)
├── /blog/sitemap.xml (blog posts)
└── /d/[destination]/sitemap.xml (destination-specific)
```

### Structured Data Implementation

**JSON-LD Schema Types**: [Source: src/lib/json-ld.ts existing patterns]

**Required Schema Implementations**:

- **Organization**: Company information and contact details
- **Website**: Main website information and search capabilities
- **Place**: Destination country information
- **GovernmentService**: Visa application services
- **Article**: Blog post content and metadata
- **BreadcrumbList**: Navigation breadcrumb structure
- **FAQPage**: Common visa questions and answers

**Schema Generation Pattern**:

```typescript
interface DestinationSchema {
  "@context": "https://schema.org";
  "@type": "Place";
  name: string;
  description: string;
  geo: GeoCoordinates;
  governmentBenefitsInfo: GovernmentService[];
}
```

### Meta Tag Optimization

**generateMetadata Function Pattern**: [Source: architecture/coding-standards.md#Next.js Standards]

- Dynamic metadata generation for all page types
- SEO-optimized titles and descriptions
- Proper canonical URL implementation
- Open Graph and Twitter Card integration

**Meta Tag Structure**:

- Title: Destination-specific with visa keywords
- Description: Compelling descriptions under 160 characters
- Keywords: Relevant visa and destination keywords
- Canonical: Absolute URLs preventing duplicate content
- Open Graph: Enhanced social media sharing
- robots: Proper indexing directives

### Database Integration for SEO

**Content Sources**: [Source: src/lib/db/schema/]

- Countries table: Destination names and descriptions
- CountriesI18n table: Multilingual SEO content
- VisaTypes table: Visa-specific SEO metadata
- VisaTypesI18n table: Localized visa descriptions

**SEO Content Generation**:

- Dynamic title generation: "{Destination} Visa Requirements for {Passport} Citizens"
- Meta descriptions from database content and templates
- Keyword extraction from destination and visa type data
- Localized content for all 8 supported languages

### Performance Considerations

**Sitemap Generation**: [Source: architecture/coding-standards.md#Performance Standards]

- Efficient database queries for sitemap content
- Caching strategies for sitemap generation
- Incremental sitemap updates for better performance
- Proper handling of large destination datasets

**SEO Performance Impact**:

- Minimal impact on Core Web Vitals from structured data
- Efficient JSON-LD generation without blocking rendering
- Optimized meta tag generation for server components
- Proper caching of SEO content

### Multilingual SEO Implementation

**i18next SEO Integration**: [Source: architecture/tech-stack.md#Internationalization]

- Localized meta tags for all 8 supported languages
- hreflang implementation for international SEO
- Localized structured data content
- RTL-specific SEO considerations for Arabic content

**URL Structure SEO**:

- Proper locale-based URL structure
- Canonical URLs preventing duplicate content issues
- Language-specific sitemap generation
- International targeting via Search Console

### Integration with Existing Systems

**Blog System Integration**: Connect with Story 1.2 blog system for blog post sitemaps and JSON-LD
**Destination Pages Integration**: Connect with Story 1.4 destination pages for enhanced SEO
**Visa Pages Integration**: Connect with Story 1.5 visa pages for structured data
**Country Service Integration**: Leverage existing country service for sitemap content

### SEO Utility Functions

**SEO Utils Location**: `/src/lib/utils/seo.ts` [Source: architecture/source-tree.md#Business Logic]

**Required Utility Functions**:

- `generateDestinationTitle(destination: string, passport: string, locale: string)`
- `generateMetaDescription(content: string, maxLength: number)`
- `generateCanonicalUrl(path: string, locale: string)`
- `extractKeywords(content: string, destination: string)`
- `validateStructuredData(jsonLd: object)`

### Testing and Validation

**SEO Testing Requirements**: [Source: architecture/coding-standards.md#Testing Standards]

- Sitemap XML validation and accessibility testing
- Structured data validation with Google Rich Results Test
- Meta tag content and length validation
- Canonical URL correctness verification
- Core Web Vitals impact testing

**SEO Validation Tools Integration**:

- Google Search Console integration preparation
- Rich Results testing automation
- Sitemap ping functionality for search engines
- SEO performance monitoring setup

### Error Handling and Fallbacks

**SEO Error Handling**: [Source: architecture/coding-standards.md#Error Handling Standards]

- Graceful fallbacks for missing SEO content
- Default meta tags when database content unavailable
- Static sitemap fallbacks for dynamic generation failures
- Proper error logging for SEO system issues

**SEO Content Fallbacks**:

- Default meta descriptions for pages without custom content
- Fallback structured data when specific content missing
- Static sitemap content for emergency situations
- Default canonical URLs for all page types

## Testing

**Location**: Tests in `__tests__/` directories alongside SEO utilities and components [Source: architecture/source-tree.md#Testing Organization]

**Framework**: Jest with SEO-specific testing utilities [Source: architecture/coding-standards.md#Testing Standards]

**Coverage Focus**: Test sitemap generation, structured data creation, meta tag optimization, and SEO utility functions

**Specific Testing Requirements**:

- Test sitemap generation with various database states and content sizes
- Test structured data validation and schema compliance
- Test meta tag generation for all page types and locales
- Test canonical URL generation and duplicate content prevention
- Test SEO performance impact and Core Web Vitals compatibility
- Test multilingual SEO implementation across all 8 supported languages
- Test error handling and fallback mechanisms for SEO system

## Change Log

| Date     | Version | Description                                                          | Author       |
| -------- | ------- | -------------------------------------------------------------------- | ------------ |
| Sep 2024 | 1.0     | Initial story creation for advanced SEO system with dynamic sitemaps | Scrum Master |

## Dev Agent Record

### Agent Model Used

_To be populated by development agent_

### Debug Log References

_To be populated by development agent_

### Completion Notes List

_To be populated by development agent_

### File List

_To be populated by development agent_

## QA Results

_To be populated by QA agent review_
